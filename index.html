<!DOCTYPE html>
<html>
	<head>
		<title></title>
		<meta charset="utf-8">
		<link rel="stylesheet" href="css/materialize.min.css" media="screen,projection">
		<link rel="stylesheet" href="css/leaflet.css">
		<link rel="stylesheet" href="js/codemirror/lib/codemirror.css">
		<link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
		<script src="js/jquery-2.2.4.min.js"></script>
		<script src="js/materialize.js"></script>
		<script src="js/knockout-3.4.0.js"></script>
		<script src="js/leaflet.js"></script>
		<script src="js/codemirror/lib/codemirror.js"></script>
		<script src="js/codemirror/mode/javascript/javascript.js"></script>
	</head>
	<style>
	#map{
    position: relative;
    height: 100%;
    min-height: 500px;
    width: 100%;
	}
	.CodeMirror {
	  border: 1px solid #eee;
	  height: 500px
	}
	</style>
	<body>
	<div class="container">
	<br><br>
		<div class="row">
			<div class="col s7">
				<div id="map"></div>
			</div>
			<div class="col s5">
				<div data-bind='codemirror:{mode: "javascript",lineNumbers: true, value: geojsonInput}'></div>
			</div>
		</div>
	</div>
	<script>
  function indexModel() {
  	// Leaflet map
    var self = this;
    self.map = L.map('map').setView([52.482780222078226, 18.676757812500004], 5);
    L.tileLayer('http://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    {attribution: '&copy; <a href="http://osm.org/copyright" title="OpenStreetMap" target="_blank">OpenStreetMap</a>'})
    .addTo(self.map);
    // CodeMirror feature
    self.geojsonInput = ko.observable('{\n\t"type":"Feature",\n\t"properties":{\n\t\t"name": "Point",\n\t\t"amenity":"Attribute",\n\t\t"popupContent":"Edit me!"\n\t},\n\t"geometry":{\n\t\t"type":"Point",\n\t\t"coordinates":[-104.99404, 39.75621]\n\t}\n}')
    ko.bindingHandlers.codemirror = {
    init: function(element, valueAccessor) {
        var options = ko.unwrap(valueAccessor());
        element.editor = CodeMirror(element, ko.toJS(options));
        element.editor.on('change', function(cm) {
            options.value(cm.getValue());
        });

        ko.utils.domNodeDisposal.addDisposeCallback(element, function() {
            var wrapper = element.editor.getWrapperElement();
            wrapper.parentNode.removeChild(wrapper);
        });
    },
    update: function(element, valueAccessor) {
        var value = ko.toJS(valueAccessor()).value;
        if (element.editor) {
            var cur = element.editor.getCursor();
            element.editor.setValue(value);
            element.editor.setCursor(cur);
            element.editor.refresh();
        }
    }
	};

  };
  var vm = new indexModel();
  ko.applyBindings(vm);
  </script>
	</body>
</html>